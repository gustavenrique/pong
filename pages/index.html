<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <div id="head"></div>

    <title>Pong - Home</title>

    <link rel="stylesheet" href="../assets/css/index.css" />
    <link rel="stylesheet" href="../assets/css/slider.css" />
  </head>
  <body class="col" id="top">
    <div class="spinner-wrapper">
      <i class="fas fa-circle-notch fa-spin fa-3x spinner"></i>
    </div>

    <div id="navbar"></div>

    <section class="main-content">
      <!-- <div id="anuncios"></div> -->
      <h3 class="text-first p-10">Recomendados</h3>
      <div id="recomendados"></div>

      <h3 class="text-first p-10" style="margin-top: 2rem;">Lançamentos</h3>
      <div id="lancamentos"></div>

      <h3 class="text-first p-10" style="margin-top: 2rem;">Mais Vendidos</h3>
      <div id="mais-vendidos"></div>

      <h3 class="text-first p-10" style="margin-top: 2rem;">Mais Populares</h3>
      <div id="mais-populares"></div>
    </section>

    <div id="footer"></div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="../api/controllers/cartController.js"></script>
    <script src="../api/controllers/gameController.js"></script>
    <script src="../api/controllers/userController.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/slider.js"></script>
    <script src="../router/router.js"></script>
    <script>
      const carrinho = async id => {
        let res = await addToCart(id);

        if (res.status == 500) {
          showAlert(res.message, 'error')
          return
        }

        if (res.status == 400) {
          showAlert(res.message)
          return
        }

        showAlert(res.message, 'success')
      }

      const gamesToSlide = (games) => {
        return games.map(game => `
          <div class="slide">
              <img class="slide-img" src="${game.image}" alt="${game.label}">

              <div class="slide-info">
                  <span class="slide-label">${game.label}</span>
                  
                  <div class="row" style='justify-content: space-between; align-items: center;'>
                      <div class="price">R$ ${game.price}</div>

                      <div class="btn btn-first" onclick='carrinho(${game.id})' style='pointer-events: auto;'>
                          <i class="fas fa-shopping-cart"></i>
                      </div>
                  </div>
              </div>
          </div>`).join("");
      };

      const buscarJogos = async () => {
        loading(true);

        let res = await getGames()

        loading(false)

        if (res.status != 200) {
          showAlert(res.message, 'error')
          return
        }

        const games = res.object

        // IMPLEMENTAR MOSTRA DE ANÚNCIOS

        slider(gamesToSlide(games.slice(0, 8)), "#recomendados");
        slider(gamesToSlide(games.slice(8, 16)), "#lancamentos");
        slider(gamesToSlide(games.slice(16, 24)), "#mais-vendidos");
        slider(gamesToSlide(games.slice(24, 32)), "#mais-populares");
      }

      buscarJogos()
    </script>
  </body>
</html>
