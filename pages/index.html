<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <div id="head"></div>

    <title>Pong - Home</title>

    <link rel="stylesheet" href="../assets/css/index.css" />
    <link rel="stylesheet" href="../assets/css/slider.css" />
  </head>
  <body class="col" id="top">
    <div class="spinner-wrapper show">
      <i class="fas fa-circle-notch fa-spin fa-3x spinner"></i>
    </div>

    <div id="navbar"></div>

    <section class="main-content" style="margin-bottom: 2rem">
      <div id="anuncios" style="margin-top: 2rem;"></div>

      <h3 class="text-first p-10">Recomendados</h3>
      <div id="recomendados"></div>

      <h3 class="text-first p-10" style="margin-top: 2rem;">Lan√ßamentos</h3>
      <div id="lancamentos"></div>

      <h3 class="text-first p-10" style="margin-top: 2rem;">Mais Vendidos</h3>
      <div id="mais-vendidos"></div>

      <h3 class="text-first p-10" style="margin-top: 2rem;">Mais Populares</h3>
      <div id="mais-populares"></div>
    </section>

    <div id="footer"></div>

    <script src="../assets/js/slider.js"></script>
    <script>
      let carrinho
    </script>
    <script type="module">
      import { getGames, getAds } from '../api/controllers/gameController.js'
      import { addToCart } from '../api/controllers/cartController.js'
      import { loading, showAlert, logOut } from '../assets/js/main.js' // ALL PAGES MUST HAVE ACCESS to logOut

      carrinho = async id => {
        let res = await addToCart(id);

        if (res.status == 500) {
          showAlert(res.message, 'error')
          return
        }

        if (res.status == 400) {
          showAlert(res.message)
          return
        }

        showAlert(res.message, 'success')
      }

      const gamesToSlide = (games) => {
        return games.map(game => `
          <div class="slide">
              <img class="slide-img" src="${game.image}" alt="${game.title}">

              <div class="slide-info">
                  <span class="slide-label">${game.title}</span>
                  
                  <div class="row" style='justify-content: space-between; align-items: center;'>
                      <div class="price">R$ ${game.price}</div>

                      <div class="btn btn-first" onclick='carrinho(${game.id})' style='pointer-events: auto;'>
                          <i class="fas fa-shopping-cart"></i>
                      </div>
                  </div>
              </div>
          </div>`).join("");
      };

      const adsToSlide = (games) => {
        return games.map(game => `
          <div class="slide ad">
              <div class="blur" style="background: url('${game.image}')"></div>
              <img class="slide-img" src="${game.image}" alt="${game.title}">
  
              <div class="ad-info">
                <div class="ad-info-inner">
                  <div class='col' style="gap: 15px">
                    <span class="ad-label">${game.title}</span>

                    <p class="ad-description">${game.description}</p>
                  </div>

                  <div class='col' style="justify-content: space-between; align-items: center; gap: 15px;">
                    <div class="price">R$ ${game.price}</div>

                    <div class="btn btn-first" onclick='carrinho(${game.id})' style='pointer-events: auto;'>
                      <i class="fas fa-shopping-cart"></i>
                    </div>
                  </div>
                </div>
              </div>
          </div>
        `)
      }

      const buscarJogos = async () => {
        loading(true)

        let [ responseGames, responseAds ] = await Promise.all([ getGames(), getAds() ])

        if (responseGames.status != 200) {
          showAlert(responseGames.message, 'error')
          return
        }

        const games = responseGames.object
        const ads = responseAds.object

        slider(adsToSlide(ads), "#anuncios", () => {
          document.querySelector('#anuncios').querySelector('.slider-container').classList.add('ad-container')
        })

        slider(gamesToSlide(games.slice(0, 8)), "#recomendados")
        slider(gamesToSlide(games.slice(8, 16)), "#lancamentos")
        slider(gamesToSlide(games.slice(16, 24)), "#mais-vendidos")
        slider(gamesToSlide(games.slice(24, 32)), "#mais-populares")

        loading(false)
      }

      buscarJogos()
    </script>
  </body>
</html>
